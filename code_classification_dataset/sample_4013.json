{
    "prob_desc_time_limit": "2 seconds",
    "prob_desc_sample_outputs": "[\"3\\n1\\n0\\n1\\n2\\n3\\n6\"]",
    "src_uid": "1de2203ba34e20fa35571a43c795da53",
    "prob_desc_notes": null,
    "prob_desc_description": "A matrix of size $$$n \\times m$$$, such that each cell of it contains either $$$0$$$ or $$$1$$$, is considered beautiful if the sum in every contiguous submatrix of size $$$2 \\times 2$$$ is exactly $$$2$$$, i. e. every \"square\" of size $$$2 \\times 2$$$ contains exactly two $$$1$$$'s and exactly two $$$0$$$'s.You are given a matrix of size $$$n \\times m$$$. Initially each cell of this matrix is empty. Let's denote the cell on the intersection of the $$$x$$$-th row and the $$$y$$$-th column as $$$(x, y)$$$. You have to process the queries of three types:  $$$x$$$ $$$y$$$ $$$-1$$$ — clear the cell $$$(x, y)$$$, if there was a number in it;  $$$x$$$ $$$y$$$ $$$0$$$ — write the number $$$0$$$ in the cell $$$(x, y)$$$, overwriting the number that was there previously (if any);  $$$x$$$ $$$y$$$ $$$1$$$ — write the number $$$1$$$ in the cell $$$(x, y)$$$, overwriting the number that was there previously (if any). After each query, print the number of ways to fill the empty cells of the matrix so that the resulting matrix is beautiful. Since the answers can be large, print them modulo $$$998244353$$$.",
    "prob_desc_output_spec": "For each query, print one integer — the number of ways to fill the empty cells of the matrix after the respective query, taken modulo $$$998244353$$$.",
    "prob_desc_input_spec": "The first line contains three integers $$$n$$$, $$$m$$$ and $$$k$$$ ($$$2 \\le n, m \\le 10^6$$$; $$$1 \\le k \\le 3 \\cdot 10^5$$$) — the number of rows in the matrix, the number of columns, and the number of queries, respectively. Then $$$k$$$ lines follow, the $$$i$$$-th of them contains three integers $$$x_i$$$, $$$y_i$$$, $$$t_i$$$ ($$$1 \\le x_i \\le n$$$; $$$1 \\le y_i \\le m$$$; $$$-1 \\le t_i \\le 1$$$) — the parameters for the $$$i$$$-th query.",
    "prob_desc_output_to": "standard output",
    "prob_desc_input_from": "standard input",
    "lang": "PyPy 3",
    "lang_cluster": "Python",
    "difficulty": 2500,
    "file_name": "train_088.jsonl",
    "code_uid": "66e6e25780c39afb5b8596d3f35c5dce",
    "prob_desc_memory_limit": "256 megabytes",
    "prob_desc_sample_inputs": "[\"2 2 7\\n1 1 1\\n1 2 1\\n2 1 1\\n1 1 0\\n1 2 -1\\n2 1 -1\\n1 1 -1\"]",
    "exec_outcome": "PASSED",
    "source_code": "import sys\r\nimport io, os\r\ninput = io.BytesIO(os.read(0,os.fstat(0).st_size)).readline\r\n\r\nn,m,k=map(int,input().split())\r\nmod=998244353\r\n\r\nMOD22=[[0,0],[0,0]]\r\n\r\nR=[[0]*n,[0]*n]\r\nC=[[0]*m,[0]*m]\r\n\r\nRB=0\r\nCB=0\r\n\r\nRK=0\r\nCK=0\r\n\r\nD=dict()\r\n\r\nANSLIST=[]\r\n\r\nPOW2=[1]\r\nfor i in range(10**6+4):\r\n    POW2.append(POW2[-1]*2%mod)\r\n\r\nfor i in range(k):\r\n    x,y,t=map(int,input().split())\r\n\r\n    x-=1\r\n    y-=1\r\n\r\n    if t!=-1:\r\n\r\n        if (x,y) in D:\r\n            if D[x,y]==t:\r\n                True\r\n            else:\r\n                D[x,y]=t\r\n\r\n                k=(y+t)%2\r\n\r\n                if R[0][x]>0 and R[1][x]>0:\r\n                    RBini=1\r\n                else:\r\n                    RBini=0\r\n                    \r\n                R[k][x]+=1\r\n                R[1-k][x]-=1\r\n\r\n                if R[0][x]>0 and R[1][x]>0:\r\n                    RBnow=1\r\n                else:\r\n                    RBnow=0\r\n\r\n                RB+=RBnow-RBini\r\n\r\n                k=(x+t)%2\r\n\r\n                if C[0][y]>0 and C[1][y]>0:\r\n                    CBini=1\r\n                else:\r\n                    CBini=0\r\n                    \r\n                C[k][y]+=1\r\n                C[1-k][y]-=1\r\n\r\n                if C[0][y]>0 and C[1][y]>0:\r\n                    CBnow=1\r\n                else:\r\n                    CBnow=0\r\n\r\n                CB+=CBnow-CBini\r\n\r\n                MOD22[t][(x+y)%2]+=1\r\n                MOD22[1-t][(x+y)%2]-=1\r\n\r\n        else:\r\n\r\n            if R[0][x]>0 and R[1][x]>0:\r\n                RBini=1\r\n            else:\r\n                RBini=0\r\n\r\n            if C[0][y]>0 and C[1][y]>0:\r\n                CBini=1\r\n            else:\r\n                CBini=0\r\n                \r\n            D[x,y]=t\r\n            k=(y+t)%2\r\n            R[k][x]+=1\r\n\r\n            if R[k][x]+R[1-k][x]==1:\r\n                RK+=1\r\n\r\n            k=(x+t)%2\r\n            C[k][y]+=1\r\n\r\n            if R[0][x]>0 and R[1][x]>0:\r\n                RBnow=1\r\n            else:\r\n                RBnow=0\r\n\r\n            RB+=RBnow-RBini\r\n\r\n            if C[k][y]+C[1-k][y]==1:\r\n                CK+=1\r\n\r\n            if C[0][y]>0 and C[1][y]>0:\r\n                CBnow=1\r\n            else:\r\n                CBnow=0\r\n\r\n            CB+=CBnow-CBini\r\n\r\n\r\n            MOD22[t][(x+y)%2]+=1\r\n            \r\n    else:\r\n        if (x,y) in D:\r\n\r\n            t=D[x,y]\r\n\r\n            k=(y+t)%2\r\n\r\n            if R[0][x]>0 and R[1][x]>0:\r\n                RBini=1\r\n            else:\r\n                RBini=0\r\n                \r\n            R[k][x]-=1\r\n\r\n            if R[k][x]+R[1-k][x]==0:\r\n                RK-=1\r\n\r\n            if R[0][x]>0 and R[1][x]>0:\r\n                RBnow=1\r\n            else:\r\n                RBnow=0\r\n\r\n            RB+=RBnow-RBini\r\n\r\n            k=(x+t)%2\r\n\r\n            if C[0][y]>0 and C[1][y]>0:\r\n                CBini=1\r\n            else:\r\n                CBini=0\r\n                \r\n            C[k][y]-=1\r\n\r\n            if C[k][y]+C[1-k][y]==0:\r\n                CK-=1\r\n\r\n            if C[0][y]>0 and C[1][y]>0:\r\n                CBnow=1\r\n            else:\r\n                CBnow=0\r\n\r\n            CB+=CBnow-CBini\r\n\r\n            MOD22[t][(x+y)%2]-=1\r\n                \r\n            del D[x,y]\r\n    \r\n        else:\r\n            True\r\n\r\n    ANS=0\r\n    #print(R,C,RB,CB,RK,CK,D,MOD22)\r\n            \r\n    if RB==0:\r\n        ANS+=POW2[n-RK]\r\n\r\n    if CB==0:\r\n        ANS+=POW2[m-CK]\r\n\r\n    if MOD22[0][0]==0 and MOD22[1][1]==0:\r\n        ANS-=1\r\n    if MOD22[1][0]==0 and MOD22[0][1]==0:\r\n        ANS-=1\r\n\r\n    ANSLIST.append(str(ANS%mod))\r\n\r\nsys.stdout.write(\"\\n\".join(ANSLIST))\r\n\r\n\r\n\r\n\r\n    \r\n    \r\n",
    "prob_desc_created_at": "1632148500",
    "tags": [
        "combinatorics",
        "constructive algorithms",
        "implementation",
        "math"
    ],
    "hidden_unit_tests": ""
}